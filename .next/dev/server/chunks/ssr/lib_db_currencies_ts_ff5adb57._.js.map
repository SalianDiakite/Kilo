{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Projet-01/projet-perso/Kilo/lib/db/currencies.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/client\"\r\n\r\nexport interface DbCurrency {\r\n  code: string\r\n  name: string\r\n  symbol: string\r\n  rate_to_eur: number\r\n  updated_at: string\r\n}\r\n\r\nexport interface Currency {\r\n  code: string\r\n  name: string\r\n  symbol: string\r\n  rateToEur: number\r\n  updatedAt: Date\r\n}\r\n\r\nfunction dbCurrencyToCurrency(db: DbCurrency): Currency {\r\n  return {\r\n    code: db.code,\r\n    name: db.name,\r\n    symbol: db.symbol,\r\n    rateToEur: db.rate_to_eur,\r\n    updatedAt: new Date(db.updated_at),\r\n  }\r\n}\r\n\r\n/**\r\n * Récupère toutes les devises\r\n */\r\nexport async function getCurrencies(): Promise<Currency[]> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"currencies\")\r\n    .select(\"*\")\r\n    .order(\"code\")\r\n  \r\n  if (error) {\r\n    console.error(\"Error fetching currencies:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return (data || []).map(dbCurrencyToCurrency)\r\n}\r\n\r\n/**\r\n * Récupère une devise par son code\r\n */\r\nexport async function getCurrency(code: string): Promise<Currency | null> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"currencies\")\r\n    .select(\"*\")\r\n    .eq(\"code\", code)\r\n    .single()\r\n  \r\n  if (error) {\r\n    if (error.code === \"PGRST116\") return null\r\n    console.error(\"Error fetching currency:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return dbCurrencyToCurrency(data)\r\n}\r\n\r\n/**\r\n * Convertit un prix en EUR vers une autre devise\r\n */\r\nexport function convertFromEur(priceInEur: number, currency: Currency): number {\r\n  return priceInEur * currency.rateToEur\r\n}\r\n\r\n/**\r\n * Convertit un prix d'une devise vers EUR\r\n */\r\nexport function convertToEur(price: number, currency: Currency): number {\r\n  return price / currency.rateToEur\r\n}\r\n\r\n/**\r\n * Formate un prix dans une devise donnée\r\n */\r\nexport function formatPrice(priceInEur: number, currency: Currency): string {\r\n  const converted = convertFromEur(priceInEur, currency)\r\n  \r\n  // Pour les grandes valeurs (CFA, etc.), pas de décimales\r\n  if (currency.rateToEur > 100) {\r\n    return `${Math.round(converted).toLocaleString('fr-FR')} ${currency.symbol}`\r\n  }\r\n  \r\n  return `${converted.toFixed(2)} ${currency.symbol}`\r\n}\r\n\r\n/**\r\n * Met à jour le taux d'une devise (admin seulement)\r\n */\r\nexport async function updateCurrencyRate(code: string, rateToEur: number): Promise<Currency> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"currencies\")\r\n    .update({ rate_to_eur: rateToEur })\r\n    .eq(\"code\", code)\r\n    .select()\r\n    .single()\r\n  \r\n  if (error) {\r\n    console.error(\"Error updating currency rate:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return dbCurrencyToCurrency(data)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAkBA,SAAS,qBAAqB,EAAc;IAC1C,OAAO;QACL,MAAM,GAAG,IAAI;QACb,MAAM,GAAG,IAAI;QACb,QAAQ,GAAG,MAAM;QACjB,WAAW,GAAG,WAAW;QACzB,WAAW,IAAI,KAAK,GAAG,UAAU;IACnC;AACF;AAKO,eAAe;IACpB,MAAM,WAAW,IAAA,yIAAY;IAE7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,KACP,KAAK,CAAC;IAET,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM;IACR;IAEA,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC;AAC1B;AAKO,eAAe,YAAY,IAAY;IAC5C,MAAM,WAAW,IAAA,yIAAY;IAE7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,QAAQ,MACX,MAAM;IAET,IAAI,OAAO;QACT,IAAI,MAAM,IAAI,KAAK,YAAY,OAAO;QACtC,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,MAAM;IACR;IAEA,OAAO,qBAAqB;AAC9B;AAKO,SAAS,eAAe,UAAkB,EAAE,QAAkB;IACnE,OAAO,aAAa,SAAS,SAAS;AACxC;AAKO,SAAS,aAAa,KAAa,EAAE,QAAkB;IAC5D,OAAO,QAAQ,SAAS,SAAS;AACnC;AAKO,SAAS,YAAY,UAAkB,EAAE,QAAkB;IAChE,MAAM,YAAY,eAAe,YAAY;IAE7C,yDAAyD;IACzD,IAAI,SAAS,SAAS,GAAG,KAAK;QAC5B,OAAO,GAAG,KAAK,KAAK,CAAC,WAAW,cAAc,CAAC,SAAS,CAAC,EAAE,SAAS,MAAM,EAAE;IAC9E;IAEA,OAAO,GAAG,UAAU,OAAO,CAAC,GAAG,CAAC,EAAE,SAAS,MAAM,EAAE;AACrD;AAKO,eAAe,mBAAmB,IAAY,EAAE,SAAiB;IACtE,MAAM,WAAW,IAAA,yIAAY;IAE7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC;QAAE,aAAa;IAAU,GAChC,EAAE,CAAC,QAAQ,MACX,MAAM,GACN,MAAM;IAET,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,MAAM;IACR;IAEA,OAAO,qBAAqB;AAC9B"}}]
}