{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Projet-01/projet-perso/Kilo/lib/db/countries.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/client\"\r\n\r\n// =============================================\r\n// TYPES\r\n// =============================================\r\n\r\nexport interface DbCountry {\r\n  id: string\r\n  code: string\r\n  name: string\r\n  name_en: string | null\r\n  flag: string\r\n  phone_code: string | null\r\n  currency_code: string | null\r\n  continent: string | null\r\n  is_active: boolean\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\nexport interface DbRegion {\r\n  id: string\r\n  country_id: string\r\n  code: string | null\r\n  name: string\r\n  name_en: string | null\r\n  is_active: boolean\r\n  created_at: string\r\n  updated_at: string\r\n  country?: DbCountry\r\n}\r\n\r\nexport interface DbCity {\r\n  id: string\r\n  country_id: string\r\n  region_id: string | null\r\n  name: string\r\n  name_en: string | null\r\n  latitude: number | null\r\n  longitude: number | null\r\n  population: number | null\r\n  is_capital: boolean\r\n  is_regional_capital: boolean\r\n  timezone: string | null\r\n  is_active: boolean\r\n  created_at: string\r\n  updated_at: string\r\n  country?: DbCountry\r\n  region?: DbRegion\r\n}\r\n\r\nexport interface Country {\r\n  id: string\r\n  code: string\r\n  name: string\r\n  nameEn?: string\r\n  flag: string\r\n  phoneCode?: string\r\n  currencyCode?: string\r\n  continent?: string\r\n}\r\n\r\nexport interface Region {\r\n  id: string\r\n  countryId: string\r\n  code?: string\r\n  name: string\r\n  nameEn?: string\r\n}\r\n\r\nexport interface City {\r\n  id: string\r\n  countryId: string\r\n  regionId?: string\r\n  name: string\r\n  nameEn?: string\r\n  population?: number\r\n  isCapital: boolean\r\n  isRegionalCapital: boolean\r\n  country?: Country\r\n  region?: Region\r\n}\r\n\r\n// =============================================\r\n// CONVERTERS\r\n// =============================================\r\n\r\nfunction dbCountryToCountry(db: DbCountry): Country {\r\n  return {\r\n    id: db.id,\r\n    code: db.code,\r\n    name: db.name,\r\n    nameEn: db.name_en || undefined,\r\n    flag: db.flag,\r\n    phoneCode: db.phone_code || undefined,\r\n    currencyCode: db.currency_code || undefined,\r\n    continent: db.continent || undefined,\r\n  }\r\n}\r\n\r\nfunction dbRegionToRegion(db: DbRegion): Region {\r\n  return {\r\n    id: db.id,\r\n    countryId: db.country_id,\r\n    code: db.code || undefined,\r\n    name: db.name,\r\n    nameEn: db.name_en || undefined,\r\n  }\r\n}\r\n\r\nfunction dbCityToCity(db: DbCity): City {\r\n  return {\r\n    id: db.id,\r\n    countryId: db.country_id,\r\n    regionId: db.region_id || undefined,\r\n    name: db.name,\r\n    nameEn: db.name_en || undefined,\r\n    population: db.population || undefined,\r\n    isCapital: db.is_capital,\r\n    isRegionalCapital: db.is_regional_capital,\r\n    country: db.country ? dbCountryToCountry(db.country) : undefined,\r\n    region: db.region ? dbRegionToRegion(db.region) : undefined,\r\n  }\r\n}\r\n\r\n// =============================================\r\n// COUNTRIES\r\n// =============================================\r\n\r\nexport async function getCountries(activeOnly = true): Promise<Country[]> {\r\n  const supabase = createClient()\r\n  \r\n  let query = supabase\r\n    .from(\"countries\")\r\n    .select(\"*\")\r\n    .order(\"name\")\r\n  \r\n  if (activeOnly) {\r\n    query = query.eq(\"is_active\", true)\r\n  }\r\n  \r\n  const { data, error } = await query\r\n  \r\n  if (error) {\r\n    console.error(\"Error fetching countries:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return (data || []).map(dbCountryToCountry)\r\n}\r\n\r\nexport async function getCountry(code: string): Promise<Country | null> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"countries\")\r\n    .select(\"*\")\r\n    .eq(\"code\", code)\r\n    .single()\r\n  \r\n  if (error) {\r\n    if (error.code === \"PGRST116\") return null\r\n    console.error(\"Error fetching country:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return dbCountryToCountry(data)\r\n}\r\n\r\n// =============================================\r\n// REGIONS\r\n// =============================================\r\n\r\nexport async function getRegionsByCountry(countryId: string): Promise<Region[]> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"regions\")\r\n    .select(\"*\")\r\n    .eq(\"country_id\", countryId)\r\n    .eq(\"is_active\", true)\r\n    .order(\"name\")\r\n  \r\n  if (error) {\r\n    console.error(\"Error fetching regions:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return (data || []).map(dbRegionToRegion)\r\n}\r\n\r\nexport async function getRegionsByCountryCode(countryCode: string): Promise<Region[]> {\r\n  const supabase = createClient()\r\n  \r\n  const { data: country } = await supabase\r\n    .from(\"countries\")\r\n    .select(\"id\")\r\n    .eq(\"code\", countryCode)\r\n    .single()\r\n  \r\n  if (!country) return []\r\n  \r\n  return getRegionsByCountry(country.id)\r\n}\r\n\r\n// =============================================\r\n// CITIES\r\n// =============================================\r\n\r\nexport async function getCitiesByCountry(countryId: string): Promise<City[]> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"cities\")\r\n    .select(\"*, country:countries(*), region:regions(*)\")\r\n    .eq(\"country_id\", countryId)\r\n    .eq(\"is_active\", true)\r\n    .order(\"population\", { ascending: false, nullsFirst: false })\r\n  \r\n  if (error) {\r\n    console.error(\"Error fetching cities:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return (data || []).map(dbCityToCity)\r\n}\r\n\r\nexport async function getCitiesByCountryCode(countryCode: string): Promise<City[]> {\r\n  const supabase = createClient()\r\n  \r\n  const { data: country } = await supabase\r\n    .from(\"countries\")\r\n    .select(\"id\")\r\n    .eq(\"code\", countryCode)\r\n    .single()\r\n  \r\n  if (!country) return []\r\n  \r\n  return getCitiesByCountry(country.id)\r\n}\r\n\r\nexport async function getCitiesByRegion(regionId: string): Promise<City[]> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"cities\")\r\n    .select(\"*, country:countries(*), region:regions(*)\")\r\n    .eq(\"region_id\", regionId)\r\n    .eq(\"is_active\", true)\r\n    .order(\"population\", { ascending: false, nullsFirst: false })\r\n  \r\n  if (error) {\r\n    console.error(\"Error fetching cities:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return (data || []).map(dbCityToCity)\r\n}\r\n\r\nexport async function searchCities(query: string, limit = 10): Promise<City[]> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"cities\")\r\n    .select(\"*, country:countries(*), region:regions(*)\")\r\n    .ilike(\"name\", `%${query}%`)\r\n    .eq(\"is_active\", true)\r\n    .order(\"population\", { ascending: false, nullsFirst: false })\r\n    .limit(limit)\r\n  \r\n  if (error) {\r\n    console.error(\"Error searching cities:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return (data || []).map(dbCityToCity)\r\n}\r\n\r\nexport async function getCity(cityId: string): Promise<City | null> {\r\n  const supabase = createClient()\r\n  \r\n  const { data, error } = await supabase\r\n    .from(\"cities\")\r\n    .select(\"*, country:countries(*), region:regions(*)\")\r\n    .eq(\"id\", cityId)\r\n    .single()\r\n  \r\n  if (error) {\r\n    if (error.code === \"PGRST116\") return null\r\n    console.error(\"Error fetching city:\", error)\r\n    throw error\r\n  }\r\n  \r\n  return dbCityToCity(data)\r\n}\r\n"],"names":[],"mappings":"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"}}]
}