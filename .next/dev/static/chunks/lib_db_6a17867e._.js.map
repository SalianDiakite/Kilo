{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Projet-01/projet-perso/Kilo/lib/db/profiles.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/client\"\r\nimport type { DbProfile, DbProfileUpdate } from \"./types\"\r\n\r\n// Client-side\r\nexport async function getProfile(userId: string) {\r\n  const supabase = createClient()\r\n  const { data, error } = await supabase.from(\"profiles\").select(\"*\").eq(\"id\", userId).single()\r\n\r\n  if (error) throw error\r\n  return data as DbProfile\r\n}\r\n\r\nexport async function updateProfile(userId: string, updates: DbProfileUpdate) {\r\n  const supabase = createClient()\r\n  const { data, error } = await supabase\r\n    .from(\"profiles\")\r\n    .update({ ...updates, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", userId)\r\n    .select()\r\n    .single()\r\n\r\n  if (error) throw error\r\n  return data as DbProfile\r\n}\r\n\r\nexport async function searchProfiles(query: string, limit = 10) {\r\n  const supabase = createClient()\r\n  const { data, error } = await supabase.from(\"profiles\").select(\"*\").ilike(\"name\", `%${query}%`).limit(limit)\r\n\r\n  if (error) throw error\r\n  return data as DbProfile[]\r\n}\r\n\nexport async function getPublicProfileById(userId: string) {\n  const supabase = createClient()\n  const { data, error } = await supabase.rpc('get_public_profile_by_id', { user_id_in: userId })\n\n  if (error) {\n    console.error('Error fetching public profile:', error)\n    throw error\n  }\n  \n  // RPC returns an array, we expect a single object or an empty array\n  return data && data.length > 0 ? data[0] : null\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAIO,eAAe,WAAW,MAAc;IAC7C,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,KAAK,EAAE,CAAC,MAAM,QAAQ,MAAM;IAE3F,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,cAAc,MAAc,EAAE,OAAwB;IAC1E,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC;QAAE,GAAG,OAAO;QAAE,YAAY,IAAI,OAAO,WAAW;IAAG,GAC1D,EAAE,CAAC,MAAM,QACT,MAAM,GACN,MAAM;IAET,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,eAAe,KAAa,EAAE,QAAQ,EAAE;IAC5D,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,KAAK,KAAK,CAAC,QAAQ,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,KAAK,CAAC;IAEtG,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,qBAAqB,MAAc;IACvD,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,4BAA4B;QAAE,YAAY;IAAO;IAE5F,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,kCAAkC;QAChD,MAAM;IACR;IAEA,oEAAoE;IACpE,OAAO,QAAQ,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,EAAE,GAAG;AAC7C"}},
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Projet-01/projet-perso/Kilo/lib/db/storage.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/client\"\nimport { updateProfile } from \"./profiles\"\n\n/**\n * Uploads a new user avatar, updates the user's profile, and returns the public URL.\n * @param userId The user's ID.\n * @param file The image file to upload.\n */\nexport async function uploadAvatar(userId: string, file: File) {\n  const supabase = createClient()\n\n  // 1. Upload the file to Storage\n  const fileExt = file.name.split(\".\").pop()\n  const filePath = `${userId}/avatar-${Date.now()}.${fileExt}`\n\n  const { error: uploadError } = await supabase.storage.from(\"Avatar\").upload(filePath, file, {\n    upsert: true, // Overwrite existing file\n    cacheControl: \"3600\",\n  })\n\n  if (uploadError) {\n    console.error(\"Error uploading avatar:\", uploadError)\n    throw uploadError\n  }\n\n  // 2. Get the public URL of the uploaded file\n  const { data: urlData } = supabase.storage.from(\"Avatar\").getPublicUrl(filePath)\n\n  if (!urlData.publicUrl) {\n    throw new Error(\"Could not get public URL for avatar.\")\n  }\n\n  // 3. Update the 'avatar' field in the user's profile\n  const updatedProfile = await updateProfile(userId, { avatar: urlData.publicUrl })\n\n  return updatedProfile\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAOO,eAAe,aAAa,MAAc,EAAE,IAAU;IAC3D,MAAM,WAAW,IAAA,4IAAY;IAE7B,gCAAgC;IAChC,MAAM,UAAU,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;IACxC,MAAM,WAAW,GAAG,OAAO,QAAQ,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,SAAS;IAE5D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,OAAO,CAAC,IAAI,CAAC,UAAU,MAAM,CAAC,UAAU,MAAM;QAC1F,QAAQ;QACR,cAAc;IAChB;IAEA,IAAI,aAAa;QACf,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACR;IAEA,6CAA6C;IAC7C,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,SAAS,OAAO,CAAC,IAAI,CAAC,UAAU,YAAY,CAAC;IAEvE,IAAI,CAAC,QAAQ,SAAS,EAAE;QACtB,MAAM,IAAI,MAAM;IAClB;IAEA,qDAAqD;IACrD,MAAM,iBAAiB,MAAM,IAAA,yIAAa,EAAC,QAAQ;QAAE,QAAQ,QAAQ,SAAS;IAAC;IAE/E,OAAO;AACT"}}]
}