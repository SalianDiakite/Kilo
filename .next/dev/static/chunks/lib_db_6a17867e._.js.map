{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Projet-01/projet-perso/Kilo/lib/db/profiles.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/client\"\r\nimport type { DbProfile, DbProfileUpdate } from \"./types\"\r\n\r\n// Client-side\r\nexport async function getProfile(userId: string) {\r\n  const supabase = createClient()\r\n  const { data, error } = await supabase.from(\"profiles\").select(\"*\").eq(\"id\", userId).single()\r\n\r\n  if (error) throw error\r\n  return data as DbProfile\r\n}\r\n\r\nexport async function updateProfile(userId: string, updates: DbProfileUpdate) {\r\n  const supabase = createClient()\r\n  const { data, error } = await supabase\r\n    .from(\"profiles\")\r\n    .update({ ...updates, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", userId)\r\n    .select()\r\n    .single()\r\n\r\n  if (error) throw error\r\n  return data as DbProfile\r\n}\r\n\r\nexport async function searchProfiles(query: string, limit = 10) {\r\n  const supabase = createClient()\r\n  const { data, error } = await supabase.from(\"profiles\").select(\"*\").ilike(\"name\", `%${query}%`).limit(limit)\r\n\r\n  if (error) throw error\r\n  return data as DbProfile[]\r\n}\r\n\r\nexport async function getPublicProfileById(userId: string) {\r\n  const supabase = createClient()\r\n  const { data, error } = await supabase\r\n    .from(\"profiles\")\r\n    .select(\r\n      \"id, name, avatar, bio, created_at, rating, review_count, verified, languages, response_time\"\r\n    )\r\n    .eq(\"id\", userId)\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching public profile:\", error)\r\n    throw error\r\n  }\r\n\r\n  return data\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAIO,eAAe,WAAW,MAAc;IAC7C,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,KAAK,EAAE,CAAC,MAAM,QAAQ,MAAM;IAE3F,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,cAAc,MAAc,EAAE,OAAwB;IAC1E,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC;QAAE,GAAG,OAAO;QAAE,YAAY,IAAI,OAAO,WAAW;IAAG,GAC1D,EAAE,CAAC,MAAM,QACT,MAAM,GACN,MAAM;IAET,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,eAAe,KAAa,EAAE,QAAQ,EAAE;IAC5D,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,KAAK,KAAK,CAAC,QAAQ,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,KAAK,CAAC;IAEtG,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,qBAAqB,MAAc;IACvD,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CACL,+FAED,EAAE,CAAC,MAAM,QACT,MAAM;IAET,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,kCAAkC;QAChD,MAAM;IACR;IAEA,OAAO;AACT"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Projet-01/projet-perso/Kilo/lib/db/storage.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/client\"\r\nimport { updateProfile } from \"./profiles\"\r\n\r\n/**\r\n * Uploads a new user avatar, updates the user's profile, and returns the public URL.\r\n * @param userId The user's ID.\r\n * @param file The image file to upload.\r\n */\r\nexport async function uploadAvatar(userId: string, file: File) {\r\n  const supabase = createClient()\r\n\r\n  // 1. Upload the file to Storage\r\n  const fileExt = file.name.split(\".\").pop()\r\n  const filePath = `${userId}/avatar-${Date.now()}.${fileExt}`\r\n\r\n  const { error: uploadError } = await supabase.storage.from(\"Avatar\").upload(filePath, file, {\r\n    upsert: true, // Overwrite existing file\r\n    cacheControl: \"3600\",\r\n  })\r\n\r\n  if (uploadError) {\r\n    console.error(\"Error uploading avatar:\", uploadError)\r\n    throw uploadError\r\n  }\r\n\r\n  // 2. Get the public URL of the uploaded file\r\n  const { data: urlData } = supabase.storage.from(\"Avatar\").getPublicUrl(filePath)\r\n\r\n  if (!urlData.publicUrl) {\r\n    throw new Error(\"Could not get public URL for avatar.\")\r\n  }\r\n\r\n  // 3. Update the 'avatar' field in the user's profile\r\n  const updatedProfile = await updateProfile(userId, { avatar: urlData.publicUrl })\r\n\r\n  return updatedProfile\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAOO,eAAe,aAAa,MAAc,EAAE,IAAU;IAC3D,MAAM,WAAW,IAAA,4IAAY;IAE7B,gCAAgC;IAChC,MAAM,UAAU,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;IACxC,MAAM,WAAW,GAAG,OAAO,QAAQ,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,SAAS;IAE5D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,OAAO,CAAC,IAAI,CAAC,UAAU,MAAM,CAAC,UAAU,MAAM;QAC1F,QAAQ;QACR,cAAc;IAChB;IAEA,IAAI,aAAa;QACf,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACR;IAEA,6CAA6C;IAC7C,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,SAAS,OAAO,CAAC,IAAI,CAAC,UAAU,YAAY,CAAC;IAEvE,IAAI,CAAC,QAAQ,SAAS,EAAE;QACtB,MAAM,IAAI,MAAM;IAClB;IAEA,qDAAqD;IACrD,MAAM,iBAAiB,MAAM,IAAA,yIAAa,EAAC,QAAQ;QAAE,QAAQ,QAAQ,SAAS;IAAC;IAE/E,OAAO;AACT"}}]
}